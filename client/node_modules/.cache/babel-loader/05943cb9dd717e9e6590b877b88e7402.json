{"ast":null,"code":"import _regeneratorRuntime from\"/Users/NobuyukiTono/Documents/Udemy/traversy-media/REACT/contactKeeper/client/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"/Users/NobuyukiTono/Documents/Udemy/traversy-media/REACT/contactKeeper/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from\"react\";import axios from\"axios\";import AuthContext from\"./authContext\";import authReducer from\"./authReducer\";import setAuthToken from\"../../utils/setAuthToken\";import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from\"../types\";var AuthState=function AuthState(props){var initialState={token:localStorage.getItem(\"token\"),isAuthenticated:null,loading:true,user:null,error:null};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// Load User\nvar loadUser=function loadUser(){var res;return _regeneratorRuntime.async(function loadUser$(_context){while(1){switch(_context.prev=_context.next){case 0:if(localStorage.token){setAuthToken(localStorage.token);}_context.prev=1;_context.next=4;return _regeneratorRuntime.awrap(axios.get(\"./api/auth\"));case 4:res=_context.sent;dispatch({type:USER_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:case\"end\":return _context.stop();}}},null,null,[[1,8]]);};// Register User\nvar register=function register(formData){var config,res;return _regeneratorRuntime.async(function register$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context2.prev=1;_context2.next=4;return _regeneratorRuntime.awrap(axios.post(\"/api/users\",formData,config));case 4:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.msg});case 12:case\"end\":return _context2.stop();}}},null,null,[[1,9]]);};// Login User\nvar login=function login(formData){var config,res;return _regeneratorRuntime.async(function login$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context3.prev=1;_context3.next=4;return _regeneratorRuntime.awrap(axios.post(\"/api/auth\",formData,config));case 4:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});loadUser();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 12:case\"end\":return _context3.stop();}}},null,null,[[1,9]]);};// Logout\nvar logout=function logout(){return dispatch({type:LOGOUT});};// Clear Errors\nvar clearErrors=function clearErrors(){return dispatch({type:CLEAR_ERRORS});};return React.createElement(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,loading:state.loading,user:state.user,error:state.error,register:register,loadUser:loadUser,login:login,logout:logout,clearErrors:clearErrors}},props.children);};export default AuthState;","map":{"version":3,"sources":["/Users/NobuyukiTono/Documents/Udemy/traversy-media/REACT/contactKeeper/client/src/context/auth/AuthState.js"],"names":["React","useReducer","axios","AuthContext","authReducer","setAuthToken","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","loading","user","error","state","dispatch","loadUser","get","res","type","payload","data","register","formData","config","headers","post","response","msg","login","logout","clearErrors","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from \"react\";\nimport axios from \"axios\";\nimport AuthContext from \"./authContext\";\nimport authReducer from \"./authReducer\";\nimport setAuthToken from \"../../utils/setAuthToken\";\nimport {\n  REGISTER_SUCCESS,\n  REGISTER_FAIL,\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGOUT,\n  CLEAR_ERRORS\n} from \"../types\";\n\nconst AuthState = props => {\n  const initialState = {\n    token: localStorage.getItem(\"token\"),\n    isAuthenticated: null,\n    loading: true,\n    user: null,\n    error: null\n  };\n\n  const [state, dispatch] = useReducer(authReducer, initialState);\n\n  // Load User\n  const loadUser = async () => {\n    if (localStorage.token) {\n      setAuthToken(localStorage.token);\n    }\n\n    try {\n      const res = await axios.get(\"./api/auth\");\n\n      dispatch({ type: USER_LOADED, payload: res.data });\n    } catch (err) {\n      dispatch({ type: AUTH_ERROR });\n    }\n  };\n\n  // Register User\n  const register = async formData => {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n\n    try {\n      const res = await axios.post(\"/api/users\", formData, config);\n\n      dispatch({\n        type: REGISTER_SUCCESS,\n        payload: res.data\n      });\n\n      loadUser();\n    } catch (err) {\n      dispatch({\n        type: REGISTER_FAIL,\n        payload: err.response.data.msg\n      });\n    }\n  };\n\n  // Login User\n  const login = async formData => {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n\n    try {\n      const res = await axios.post(\"/api/auth\", formData, config);\n\n      dispatch({\n        type: LOGIN_SUCCESS,\n        payload: res.data\n      });\n\n      loadUser();\n    } catch (err) {\n      dispatch({\n        type: LOGIN_FAIL,\n        payload: err.response.data.msg\n      });\n    }\n  };\n  // Logout\n  const logout = () => {\n    return dispatch({ type: LOGOUT });\n  };\n  // Clear Errors\n  const clearErrors = () => {\n    return dispatch({ type: CLEAR_ERRORS });\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        token: state.token,\n        isAuthenticated: state.isAuthenticated,\n        loading: state.loading,\n        user: state.user,\n        error: state.error,\n        register,\n        loadUser,\n        login,\n        logout,\n        clearErrors\n      }}\n    >\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthState;\n"]},"metadata":{},"sourceType":"module"}